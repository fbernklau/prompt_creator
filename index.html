<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EduPrompt-AT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
    <script>
      window.tailwind = window.tailwind || {};
      window.tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: '#4F46E5',
            },
          },
        },
      };
    </script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  </head>
  <body>
    <header class="topbar">
      <div class="topbar-inner">
        <div class="brand">
          <div class="brand-mark">EP</div>
          <div class="brand-name">EduPrompt-AT</div>
        </div>
        <div class="topbar-actions">
          <button id="btn-new-task" data-nav-id="btn-new-task" type="button" class="text-btn nav-btn">Neue Aufgabe</button>
          <button id="btn-library" data-nav-id="btn-library" type="button" class="text-btn nav-btn">Bibliothek</button>
          <button id="btn-dashboard" data-nav-id="btn-dashboard" type="button" class="text-btn nav-btn">Dashboard</button>
          <button id="btn-templates" data-nav-id="btn-templates" type="button" class="text-btn nav-btn is-hidden">Templates</button>
          <button id="btn-provider" data-nav-id="btn-provider" type="button" class="text-btn nav-btn">API-Provider</button>
          <button id="btn-options" data-nav-id="btn-options" type="button" class="text-btn nav-btn">Optionen</button>
          <button id="btn-admin" data-nav-id="btn-admin" type="button" class="text-btn nav-btn is-hidden">Admin</button>
          <div class="user-chip-wrap">
            <span class="user-chip" id="current-user">Benutzer: lade...</span>
            <button id="btn-logout" type="button" class="text-btn user-logout-btn is-hidden">Logout</button>
          </div>
        </div>
      </div>
    </header>

    <nav id="mobile-bottom-nav" class="mobile-bottom-nav" aria-label="Mobile Navigation">
      <button id="mb-new-task" data-nav-id="btn-new-task" type="button" class="nav-btn mobile-nav-btn">
        <span class="material-icons-round">add_circle</span>
        <span>Neu</span>
      </button>
      <button id="mb-library" data-nav-id="btn-library" type="button" class="nav-btn mobile-nav-btn">
        <span class="material-icons-round">library_books</span>
        <span>Bibliothek</span>
      </button>
      <button id="mb-dashboard" data-nav-id="btn-dashboard" type="button" class="nav-btn mobile-nav-btn">
        <span class="material-icons-round">dashboard</span>
        <span>Dashboard</span>
      </button>
      <button id="mb-provider" data-nav-id="btn-provider" type="button" class="nav-btn mobile-nav-btn">
        <span class="material-icons-round">api</span>
        <span>Provider</span>
      </button>
      <button id="mb-options" data-nav-id="btn-options" type="button" class="nav-btn mobile-nav-btn">
        <span class="material-icons-round">tune</span>
        <span>Optionen</span>
      </button>
    </nav>

    <main class="main-shell">
      <section id="screen-home" class="screen tw-home">
        <div class="tw-home-hero">
          <div class="tw-home-hero-head">
            <h1 class="tw-home-title">Wie kann ich dir heute helfen?</h1>
            <button id="btn-start-tour" type="button" class="secondary small">Tour starten</button>
          </div>
          <p class="tw-home-subline">W&auml;hle ein Handlungsfeld aus dem Schulalltag, um einen ma&szlig;geschneiderten KI-Prompt zu erstellen.</p>
        </div>

        <section class="tw-home-search-card">
          <div class="tw-home-search-row">
            <label class="tw-home-search-label">Template Suche
              <div class="tw-home-search-input-wrap">
                <span class="material-icons-round tw-home-search-icon">search</span>
                <input id="home-template-search" class="tw-home-search-input" placeholder="Titel, Kategorie, Unterkategorie..." />
              </div>
            </label>
            <div class="tw-home-search-actions">
              <button id="home-template-search-btn" type="button" class="tw-home-btn-primary">Suchen</button>
              <button id="home-template-reset-btn" type="button" class="tw-home-btn-secondary">Zur&uuml;cksetzen</button>
            </div>
          </div>
          <div id="home-tag-chips" class="tw-home-tags"></div>
        </section>
        <section id="home-search-results-section" class="panel tw-home-search-results is-hidden">
          <div class="tw-home-search-results-head">
            <h3>Suchergebnisse</h3>
            <small id="home-search-results-status" class="hint"></small>
          </div>
          <div id="home-search-results" class="tw-home-search-results-list"></div>
        </section>

        <div id="category-grid" class="tw-home-category-grid"></div>

        <section class="tw-home-discovery-section">
          <div class="tw-home-discovery-head">
            <div>
              <h2 class="tw-home-discovery-title">Template Discovery</h2>
              <p class="tw-home-subline">Schnellzugriff auf empfohlene und zuletzt genutzte Vorlagen.</p>
            </div>
            <button id="home-show-all-templates" type="button" class="tw-home-show-all">Alle anzeigen</button>
          </div>
          <div class="tw-home-discovery-card">
            <div class="tw-home-discovery-grid">
              <div id="home-discovery-col-recommended">
                <h4 id="home-discovery-title-recommended" class="tw-home-discovery-col-title"><span class="material-icons-round text-primary text-[18px]">recommend</span>Empfohlen</h4>
                <div id="home-recommended-list" class="tw-home-list"></div>
              </div>
              <div id="home-discovery-col-recent">
                <h4 class="tw-home-discovery-col-title"><span class="material-icons-round text-primary text-[18px]">history</span>Zuletzt genutzt</h4>
                <div id="home-recent-list" class="tw-home-list"></div>
              </div>
              <div id="home-discovery-col-favorites">
                <h4 class="tw-home-discovery-col-title"><span class="material-icons-round text-amber-500 text-[18px]">star</span>Favoriten</h4>
                <div id="home-favorites-list" class="tw-home-list"></div>
              </div>
            </div>
            <small id="home-discovery-status" class="tw-home-discovery-status"></small>
          </div>
        </section>
      </section>

      <section id="screen-subcategory" class="screen is-hidden tw-subcat">
        <div class="tw-subcat-crumb-row">
          <button id="btn-back-home-from-subcat" type="button" class="link-btn tw-subcat-back">
            <span class="material-icons-round">arrow_back</span>
            Zur&uuml;ck zur &Uuml;bersicht
          </button>
          <div class="tw-subcat-view-toggle">
            <button id="subcat-view-grid" type="button" class="tw-subcat-view-btn is-active" aria-label="Grid-Ansicht">
              <span class="material-icons-round">grid_view</span>
            </button>
            <button id="subcat-view-list" type="button" class="tw-subcat-view-btn" aria-label="Listen-Ansicht">
              <span class="material-icons-round">view_list</span>
            </button>
          </div>
        </div>
        <h2 id="selected-category-title"></h2>
        <p id="selected-category-desc" class="subline"></p>
        <div id="subcategory-list" class="subcategory-grid top-space tw-subcat-grid"></div>
        <div class="tw-subcat-footer">
          <small id="subcategory-count" class="hint"></small>
        </div>
      </section>

      <section id="screen-form" class="screen is-hidden tw-form">
        <div class="step-nav tw-form-nav">
          <button id="btn-back-subcat" type="button" class="secondary back-nav-btn">&larr; Zur&uuml;ck zur Unterkategorie-Auswahl</button>
          <button id="btn-back-home-from-form" type="button" class="link-btn">Zur &Uuml;bersicht</button>
        </div>

        <div class="form-header tw-form-header">
          <h2 id="form-category-title"></h2>
          <p id="form-subcategory-title" class="subline"></p>
          <p id="form-template-description" class="subline"></p>
        </div>

        <form id="prompt-form" class="stack-form">
          <div id="compact-flow-panel" class="panel panel-soft tw-form-card tw-compact-flow is-hidden">
            <h3>Kompaktansicht</h3>
            <small class="hint">Waehle Kategorie und Template. Die naechste Stufe oeffnet automatisch.</small>
            <div class="tw-compact-flow-steps top-space">
              <div id="flow-step-category" class="tw-compact-step">
                <div class="tw-compact-step-head">
                  <strong>1. Handlungsfeld</strong>
                  <button id="flow-edit-category" type="button" class="text-btn small is-hidden">&Auml;ndern</button>
                </div>
                <div class="tw-compact-step-body top-space">
                  <label for="flow-category-select" class="sr-only">Handlungsfeld</label>
                  <select id="flow-category-select"></select>
                </div>
                <small id="flow-category-summary" class="hint is-hidden"></small>
              </div>

              <div id="flow-step-template" class="tw-compact-step is-hidden">
                <div class="tw-compact-step-head">
                  <strong>2. Template</strong>
                  <button id="flow-edit-template" type="button" class="text-btn small is-hidden">&Auml;ndern</button>
                </div>
                <div class="tw-compact-step-body top-space">
                  <label for="flow-template-select" class="sr-only">Template</label>
                  <select id="flow-template-select"></select>
                </div>
                <small id="flow-template-summary" class="hint is-hidden"></small>
              </div>
            </div>
          </div>

          <div id="form-required-panel" class="panel panel-soft form-required-panel tw-form-card tw-form-required">
            <h3 id="required-panel-title">Template - Pflichtfelder</h3>
            <small id="validation-hint" class="hint"></small>
            <div id="required-fields-grid" class="grid-2 compact-grid top-space"></div>
          </div>

          <div id="form-optional-panel" class="panel form-optional-panel tw-form-card">
            <h3 id="optional-panel-title">Template - Optionale Felder</h3>
            <div id="optional-fields-grid" class="grid-2 compact-grid top-space"></div>
          </div>

          <div id="field-pool" class="is-hidden">
            <div id="base-fields-pool" class="is-hidden">
              <label id="wrap-fach"><span id="label-fach">Fach *</span>
                <input id="fach" placeholder="z. B. Digitale Grundbildung" />
                <small id="hint-fach" class="hint">Beispiel: Mathematik, Deutsch, Physik.</small>
              </label>
              <label id="wrap-schulstufe"><span id="label-schulstufe">Schulstufe *</span>
                <input id="schulstufe" placeholder="z. B. 9. Schulstufe" />
                <small id="hint-schulstufe" class="hint">Beispiel: 7. Schulstufe, Sek II.</small>
              </label>
              <label id="wrap-ziel" class="span-2"><span id="label-ziel">Ziel der Aufgabe *</span>
                <textarea id="ziel" rows="3" placeholder="Was soll konkret vorliegen?"></textarea>
                <small id="hint-ziel" class="hint">Formuliere den Zielzustand klar, nicht nur das Thema.</small>
              </label>
            </div>
            <div id="dynamic-fields-pool" class="is-hidden"></div>
          </div>

          <div id="form-advanced-panel" class="panel form-advanced-panel tw-form-card">
            <div class="panel-title-row">
              <h3>Erweiterte Optionen</h3>
              <button id="toggle-advanced" type="button" class="text-btn small">▼ Optionen einblenden</button>
            </div>
            <small id="advanced-section-hint" class="hint">Diese Sektion ist ein-/ausklappbar.</small>

            <div id="advanced-fields" class="grid-2 top-space">
              <label>Zeitraum
                <select id="zeitrahmen-select"></select>
              </label>
              <label id="zeitrahmen-custom-wrap">Zeitraum (custom)
                <input id="zeitrahmen-custom" placeholder="Eigener Zeitraum" />
              </label>
              <div id="zeitrahmen-range-wrap" class="span-2 grid-2 is-hidden">
                <label>Zeitraum von
                  <input id="zeitrahmen-range-start" type="datetime-local" />
                </label>
                <label>Zeitraum bis
                  <input id="zeitrahmen-range-end" type="datetime-local" />
                </label>
              </div>

              <label>Niveau
                <select id="niveau-select"></select>
              </label>
              <label>Niveau (custom)
                <input id="niveau-custom" placeholder="Eigenes Niveau" />
              </label>

              <label>Rahmen
                <select id="rahmen-select"></select>
              </label>
              <label>Rahmen (custom)
                <input id="rahmen-custom" placeholder="Eigener Rahmen" />
              </label>

              <label>Ergebnisformat
                <select id="ergebnisformat-select"></select>
              </label>
              <label>Ergebnisformat (custom)
                <input id="ergebnisformat-custom" placeholder="Eigenes Format" />
              </label>

              <label>Tonalitaet / Sprache
                <select id="ton-select"></select>
              </label>
              <label>Tonalitaet (custom)
                <input id="ton-custom" placeholder="Eigener Stil" />
              </label>
            </div>

            <label class="checkbox top-space">
              <input id="rueckfragen" type="checkbox" checked />
              <span>Kl&auml;rende R&uuml;ckfragen aktivieren</span>
            </label>
          </div>
          <div id="form-oneoff-panel" class="panel form-oneoff-panel tw-form-card tw-form-oneoff">
            <div class="panel-title-row">
              <h3>Einmaliger Template-Override (optional)</h3>
            </div>
            <label class="checkbox">
              <input id="oneoff-enable" type="checkbox" />
              <span>Nur f&uuml;r diesen Lauf ein angepasstes Template verwenden</span>
            </label>
            <div id="oneoff-fields" class="grid-2 top-space is-hidden">
              <label>Prompt Mode
                <select id="oneoff-prompt-mode">
                  <option value="">(Template-Standard)</option>
                  <option value="schema">schema</option>
                  <option value="custom">custom</option>
                </select>
              </label>
              <label>Profil (optional)
                <input id="oneoff-profile" placeholder="z. B. unterrichtsnah" />
              </label>
              <label class="span-2">Beschreibung f&uuml;r diesen Lauf
                <textarea id="oneoff-description" rows="2" placeholder="Zus&auml;tzliche Hinweise f&uuml;r den Promptaufbau"></textarea>
              </label>
              <label class="span-2">Base Prompt Override (bei custom)
                <textarea id="oneoff-base-prompt" rows="5" placeholder="Eigener Base Prompt mit {{variablen}}"></textarea>
              </label>
              <label class="span-2">Tags (CSV, optional)
                <input id="oneoff-tags" placeholder="z. B. differenzierung,projektlernen" />
              </label>
              <label class="checkbox span-2">
                <input id="oneoff-save-personal" type="checkbox" />
                <span>Als pers&ouml;nliche Template-Variante speichern</span>
              </label>
              <label class="span-2">Titel-Suffix f&uuml;r gespeicherte Variante
                <input id="oneoff-save-suffix" placeholder="z. B. (Supervisor-Testversion)" />
              </label>
            </div>
          </div>

          <div id="form-right-rail" class="tw-form-right-rail">
            <div class="inline-actions form-submit-row tw-form-submit-row">
              <div class="tw-run-mode-switch-wrap">
                <span class="tw-run-mode-kicker">Ausgabe f&uuml;r diesen Lauf</span>
                <label class="admin-toggle tw-run-mode-toggle">
                  <span class="tw-run-mode-option tw-run-mode-option-left">Prompt</span>
                  <input id="run-mode-result-toggle" type="checkbox" />
                  <span class="admin-toggle-track" aria-hidden="true"><span class="admin-toggle-thumb"></span></span>
                  <span class="tw-run-mode-option">Direktes Ergebnis</span>
                </label>
              </div>
              <div class="tw-form-generate-actions">
                <button id="generate-submit" type="submit" class="cta">Prompt generieren</button>
              </div>
              <small id="generation-status" class="hint"></small>
            </div>
            <div id="generation-validation" class="form-validation is-hidden" aria-live="polite"></div>

            <div class="panel form-metaprompt-panel tw-form-preview-card">
              <div class="panel-title-row tw-form-preview-head">
                <h3><span class="material-icons-round">visibility</span> Live Metaprompt Vorschau</h3>
                <button id="btn-preview-metaprompt" type="button" class="secondary">Aktualisieren</button>
              </div>
              <small id="metaprompt-preview-status" class="hint"></small>
              <div class="metaprompt-preview-box top-space">
                <div class="tw-preview-window-head">
                  <span class="tw-preview-window-dots" aria-hidden="true">
                    <span></span><span></span><span></span>
                  </span>
                  <span class="tw-preview-window-title">SYSTEM_PROMPT.MD</span>
                </div>
                <button id="copy-metaprompt-preview" type="button" class="secondary result-copy-inside">Kopieren</button>
                <textarea id="metaprompt-preview" rows="10" placeholder="Hier erscheint die serverseitig generierte Metaprompt-Vorschau. Du kannst sie direkt bearbeiten."></textarea>
              </div>
              <label class="checkbox top-space">
                <input id="use-preview-metaprompt" type="checkbox" />
                <span>Bearbeitete Metaprompt direkt f&uuml;r Generierung verwenden</span>
              </label>
            </div>
          </div>
        </form>
      </section>

      <section id="screen-result" class="screen is-hidden tw-result">
        <div class="result-layout tw-result-grid">
          <aside class="tw-result-sidebar">
            <div class="panel tw-result-details-card">
              <h3 class="tw-result-details-title">
                <span class="material-icons-round">tune</span>
                Prompt Details
              </h3>
              <div class="tw-result-details-list">
                <div class="tw-result-detail-item">
                  <small>Handlungsfeld</small>
                  <strong id="result-detail-handlungsfeld">-</strong>
                </div>
                <div class="tw-result-detail-item">
                  <small>Unterkategorie</small>
                  <strong id="result-detail-unterkategorie">-</strong>
                </div>
                <div class="tw-result-detail-item">
                  <small>Fach</small>
                  <strong id="result-detail-fach">-</strong>
                </div>
                <div class="tw-result-detail-item">
                  <small>Schulstufe</small>
                  <strong id="result-detail-schulstufe">-</strong>
                </div>
              </div>
              <button id="btn-adjust" type="button" class="secondary tw-result-edit-btn">
                <span class="material-icons-round">edit</span>
                Parameter bearbeiten
              </button>
            </div>
            <div class="panel tw-result-side-hint">
              <strong>Hinweis</strong>
              <small class="hint">Der generierte Prompt ist f&uuml;r den direkten Handoff an dein Ziel-LLM gedacht.</small>
            </div>
          </aside>
          <div class="tw-result-main">
            <div id="result-ready-banner" class="result-banner is-hidden"></div>
            <div id="result-progress-panel" class="panel result-progress-panel">
              <div id="result-progress-meta-row" class="result-progress-row">
                <div class="result-progress-head">
                  <strong>Metaprompt</strong>
                  <small id="result-progress-meta-status" class="hint">wartet</small>
                </div>
                <div class="result-progress-bar-track">
                  <div id="result-progress-meta-bar" class="result-progress-bar"></div>
                </div>
              </div>
              <div id="result-progress-direct-row" class="result-progress-row is-hidden">
                <div class="result-progress-head">
                  <strong>Direktes Ergebnis</strong>
                  <small id="result-progress-direct-status" class="hint">wartet</small>
                </div>
                <div class="result-progress-bar-track">
                  <div id="result-progress-direct-bar" class="result-progress-bar"></div>
                </div>
              </div>
            </div>

            <div class="panel top-space result-prompt-panel">
              <div class="tw-result-main-head">
                <div>
                  <h3>Generated Meta-Prompt</h3>
                  <small id="result-meta" class="hint"></small>
                  <div id="result-usage-summary" class="result-usage-summary is-hidden" aria-live="polite">
                    <span>Input: <strong id="result-usage-input">-</strong></span>
                    <span>Output: <strong id="result-usage-output">-</strong></span>
                    <span>Total: <strong id="result-usage-total">-</strong></span>
                  </div>
                  <div id="result-cost-summary" class="result-usage-summary result-cost-summary is-hidden" aria-live="polite">
                    <span>Input-Kosten: <strong id="result-cost-input">-</strong></span>
                    <span>Output-Kosten: <strong id="result-cost-output">-</strong></span>
                    <span>Total-Kosten: <strong id="result-cost-total">-</strong></span>
                  </div>
                </div>
                <div class="inline-actions">
                  <button id="copy-prompt-meta" type="button" class="secondary">Kopieren (mit Metadata)</button>
                  <button id="copy-prompt-clean" type="button" class="secondary">Kopieren</button>
                </div>
              </div>
              <div id="result-metadata-panel" class="result-metadata-panel is-hidden">
                <div class="result-metadata-head">
                  <strong>Metadata</strong>
                  <small class="hint">Beinhaltet technischen Laufkontext (Provider, Modell, Key-Quelle, Template, Modus).</small>
                </div>
                <ul id="result-metadata-list" class="result-metadata-list"></ul>
              </div>
              <div class="result-prompt-box top-space">
                <textarea id="result" rows="16" readonly></textarea>
              </div>
            </div>

            <div id="result-direct-panel" class="panel top-space result-prompt-panel is-hidden">
              <div class="tw-result-main-head">
                <div>
                  <h3>Direktes Ergebnis</h3>
                  <small id="result-direct-meta" class="hint"></small>
                  <div id="result-direct-usage-summary" class="result-usage-summary is-hidden" aria-live="polite">
                    <span>Input: <strong id="result-direct-usage-input">-</strong></span>
                    <span>Output: <strong id="result-direct-usage-output">-</strong></span>
                    <span>Total: <strong id="result-direct-usage-total">-</strong></span>
                  </div>
                  <div id="result-direct-cost-summary" class="result-usage-summary result-cost-summary is-hidden" aria-live="polite">
                    <span>Input-Kosten: <strong id="result-direct-cost-input">-</strong></span>
                    <span>Output-Kosten: <strong id="result-direct-cost-output">-</strong></span>
                    <span>Total-Kosten: <strong id="result-direct-cost-total">-</strong></span>
                  </div>
                </div>
                <div class="inline-actions">
                  <button id="copy-result-direct" type="button" class="secondary">Ergebnis kopieren</button>
                </div>
              </div>
              <div class="result-prompt-box top-space">
                <textarea id="result-direct-output" rows="16" readonly></textarea>
              </div>
            </div>

            <div class="panel top-space">
              <div class="inline-actions result-actions-row">
                <button id="export-txt" type="button" class="secondary">Export .txt</button>
                <button id="export-md" type="button" class="secondary">Export .md</button>
                <button id="btn-compare-last" type="button" class="secondary">Mit vorheriger Version vergleichen</button>
              </div>
            </div>

            <div id="result-compare-panel" class="panel top-space is-hidden">
              <h3>Vergleich zur vorherigen Generation</h3>
              <div class="grid-2 top-space">
                <label>Aktuelle Version
                  <textarea id="result-compare-current" rows="10" readonly></textarea>
                </label>
                <label>Vorherige Version
                  <textarea id="result-compare-previous" rows="10" readonly></textarea>
                </label>
              </div>
            </div>

            <div class="panel top-space">
              <h3>In Bibliothek speichern</h3>
              <div class="grid-2">
                <label class="span-2">Titel
                  <input id="library-title" placeholder="z. B. Stoffverteilungsplan 9. Schulstufe" />
                </label>
                <label>Bewertung
                  <select id="library-rating">
                    <option value="">Keine</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                  </select>
                </label>
                <label class="checkbox">
                  <input id="library-public" type="checkbox" />
                  <span>In &ouml;ffentliche Bibliothek aufnehmen</span>
                </label>
              </div>
              <div class="inline-actions top-space">
                <button id="save-library" type="button">In Bibliothek speichern</button>
                <small id="save-library-status" class="hint"></small>
              </div>
              <div class="inline-actions top-space">
                <small id="result-variant-status" class="hint"></small>
                <button id="btn-open-templates-from-result" type="button" class="secondary is-hidden">Template Studio &ouml;ffnen</button>
              </div>
            </div>

            <div class="inline-actions top-space result-final-actions">
              <button id="btn-restart-from-result" type="button" class="secondary">Neue Aufgabe starten</button>
            </div>
          </div>
        </div>
      </section>

      <section id="screen-dashboard" class="screen is-hidden">
        <div class="step-nav">
          <button id="btn-back-home-from-dashboard" type="button" class="link-btn">&larr; Zur&uuml;ck zur &Uuml;bersicht</button>
        </div>
        <h2>Dashboard</h2>
        <p class="subline">API-Provider verwalten, Nutzungswerte pr&uuml;fen und Optionen zentral steuern.</p>

        <div id="dashboard-tab-nav" class="chip-row top-space dashboard-tab-nav">
          <button type="button" class="secondary is-active" data-dashboard-tab="providers">API-Provider</button>
          <button type="button" class="secondary" data-dashboard-tab="usage">Nutzungsdaten</button>
          <button type="button" class="secondary" data-dashboard-tab="history">Verlauf</button>
          <button type="button" class="secondary" data-dashboard-tab="options">Optionen</button>
        </div>

        <div id="dashboard-tab-providers" class="dashboard-tab-panel top-space">
          <div class="panel">
            <div class="panel-title-row">
              <h3>API-Provider</h3>
              <small id="dashboard-provider-stage-hint" class="hint">Aktiviere pro Stage genau einen Key (Metaprompt und Result getrennt).</small>
            </div>
            <div id="dashboard-provider-host" class="top-space"></div>
          </div>

          <div id="usage-budget-panel" class="panel top-space is-hidden">
            <h3>Budget-Übersicht</h3>
            <small class="hint">Globales Nutzerbudget und Key-spezifische Budgets (USD).</small>
            <div class="admin-model-provider-card top-space">
              <div class="admin-model-provider-head">
                <h4>Globales Budget</h4>
                <small id="usage-budget-global-used" class="hint">Used / Total: -</small>
              </div>
              <div class="grid-3 top-space">
                <label>Limit USD
                  <input id="usage-budget-global-limit" type="number" min="0" step="0.000001" placeholder="z. B. 25.00" />
                </label>
                <label>Periode
                  <select id="usage-budget-global-period">
                    <option value="daily">daily</option>
                    <option value="weekly">weekly</option>
                    <option value="monthly" selected>monthly</option>
                  </select>
                </label>
                <label>Aktiv
                  <span class="admin-toggle">
                    <input id="usage-budget-global-active" type="checkbox" />
                    <span class="admin-toggle-track"><span class="admin-toggle-thumb"></span></span>
                    <span class="admin-toggle-text">Aktiv</span>
                  </span>
                </label>
              </div>
              <div class="inline-actions top-space">
                <button id="usage-budget-global-save" type="button">Globales Budget speichern</button>
                <small id="usage-budget-status" class="hint"></small>
              </div>
            </div>

            <div class="top-space">
              <h4>Persönliche Keys</h4>
              <ul id="usage-budget-personal-list" class="provider-list top-space"></ul>
            </div>
            <div class="top-space">
              <h4>Zugewiesene Keys</h4>
              <ul id="usage-budget-assigned-list" class="provider-list top-space"></ul>
            </div>
          </div>
        </div>

        <div id="dashboard-tab-usage" class="dashboard-tab-panel top-space is-hidden">
          <div class="panel">
            <div class="inline-actions">
              <label>Zeitraum
                <select id="usage-window-days">
                  <option value="7">7 Tage</option>
                  <option value="14">14 Tage</option>
                  <option value="30" selected>30 Tage</option>
                  <option value="60">60 Tage</option>
                  <option value="120">120 Tage</option>
                </select>
              </label>
              <button id="usage-refresh" type="button">Aktualisieren</button>
              <small id="usage-status" class="hint"></small>
            </div>
          </div>

          <div class="grid-3 top-space">
            <div class="panel">
              <h3>Anfragen</h3>
              <p id="usage-total-requests" class="metric">0</p>
            </div>
            <div class="panel">
              <h3>Erfolgsquote</h3>
              <p id="usage-success-rate" class="metric">0%</p>
            </div>
            <div class="panel">
              <h3>Ø Latenz</h3>
              <p id="usage-avg-latency" class="metric">0 ms</p>
            </div>
          </div>
          <div class="grid-2 top-space">
            <div class="panel">
              <h3>Input Tokens</h3>
              <p id="usage-prompt-tokens" class="metric">0</p>
            </div>
            <div class="panel">
              <h3>Output Tokens</h3>
              <p id="usage-completion-tokens" class="metric">0</p>
            </div>
          </div>
          <div class="grid-2 top-space">
            <div class="panel">
              <h3>Tokens gesamt</h3>
              <p id="usage-total-tokens" class="metric">0</p>
            </div>
            <div class="panel">
              <h3>Kosten (USD)</h3>
              <p id="usage-total-cost" class="metric">$0.0000</p>
            </div>
          </div>

          <div class="panel top-space">
            <h3>Provider &Uuml;berblick</h3>
            <div class="table-wrap top-space">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Provider</th>
                    <th>Requests</th>
                    <th>Success Rate</th>
                    <th>Ø Latenz</th>
                    <th>Input</th>
                    <th>Output</th>
                    <th>Tokens</th>
                    <th>Kosten (USD)</th>
                    <th>Letzter Fehler</th>
                  </tr>
                </thead>
                <tbody id="usage-provider-body"></tbody>
              </table>
            </div>
          </div>

          <div class="panel top-space">
            <h3>Nutzung pro API-Key (Fingerprint)</h3>
            <ul id="usage-key-list" class="provider-list top-space"></ul>
          </div>

          <div class="panel top-space">
            <h3>Top Templates</h3>
            <ul id="usage-template-list" class="provider-list top-space"></ul>
          </div>

        </div>

        <div id="dashboard-tab-history" class="dashboard-tab-panel top-space is-hidden">
          <div class="panel">
            <h3>Prompt-Verlauf</h3>
            <small class="hint">Zuletzt erzeugte Prompts mit Zeitstempel.</small>
            <ul id="history-list" class="history-list top-space"></ul>
          </div>
        </div>

        <div id="dashboard-tab-options" class="dashboard-tab-panel top-space is-hidden">
          <div class="panel">
            <h3>Optionen</h3>
            <small class="hint">Pers&ouml;nliche Anzeige- und Arbeitsoptionen.</small>
            <div id="dashboard-options-host" class="top-space"></div>
          </div>
        </div>
      </section>

      <section id="screen-library" class="screen is-hidden tw-library">
        <div class="tw-library-head">
          <div class="step-nav tw-library-nav">
            <button id="btn-back-home-from-library" type="button" class="link-btn">&larr; Zur&uuml;ck zur &Uuml;bersicht</button>
          </div>
          <div class="tw-library-title-row">
            <div>
              <h2>Prompt &amp; Template Library</h2>
              <p class="subline">Eigene Prompts verwalten, bewerten und in der Community durchsuchen.</p>
            </div>
            <button id="lib-refresh" type="button" class="tw-library-primary-action">
              <span class="material-icons-round">refresh</span>
              Aktualisieren
            </button>
          </div>
        </div>

        <div class="panel library-toolbar tw-library-toolbar">
          <div class="tw-library-toolbar-row">
            <label class="tw-library-search-wrap">Suche
              <span class="material-icons-round tw-library-search-icon">search</span>
              <input id="lib-filter-search" placeholder="Titel oder Inhalt" />
            </label>
            <div class="tw-library-tabs">
              <button id="lib-tab-public" type="button" class="secondary">Community Library</button>
              <button id="lib-tab-own" type="button" class="secondary is-active">My Prompts</button>
            </div>
          </div>
          <div class="tw-library-filter-row">
            <label>Handlungsfeld
              <select id="lib-filter-category"></select>
            </label>
            <label>Unterkategorie
              <select id="lib-filter-subcategory"></select>
            </label>
            <label>Template
              <select id="lib-filter-template"></select>
            </label>
            <label>Modus
              <select id="lib-filter-mode">
                <option value="">Alle</option>
                <option value="prompt">Prompt</option>
                <option value="result">Direktes Ergebnis</option>
              </select>
            </label>
          </div>
        </div>

        <div id="library-list" class="library-list top-space tw-library-grid"></div>
      </section>

      <section id="screen-library-entry" class="screen is-hidden tw-library">
        <div class="step-nav">
          <button id="btn-back-library-entry" type="button" class="link-btn">&larr; Zur&uuml;ck zur Bibliothek</button>
        </div>
        <div id="library-entry-page-content" class="top-space"></div>
      </section>

      <section id="screen-templates" class="screen is-hidden">
        <div class="step-nav">
          <button id="btn-back-home-from-templates" type="button" class="link-btn">&larr; Zur&uuml;ck zur &Uuml;bersicht</button>
        </div>
        <h2>Template Studio</h2>
        <p class="subline">Pers&ouml;nliche Templates erstellen, Varianten speichern, zur Review einreichen und Community/Official verwalten.</p>

        <div id="template-wizard-panel" class="panel top-space">
          <div class="panel-title-row">
            <h3>Template Wizard</h3>
            <label class="checkbox">
              <input id="template-wizard-enabled" type="checkbox" checked />
              <span>Gef&uuml;hrten Modus verwenden</span>
            </label>
          </div>
          <div id="template-wizard-controls" class="inline-actions top-space">
            <label class="radio">
              <input type="radio" name="template-wizard-mode" value="existing" checked />
              <span>Mit bestehender Vorlage starten</span>
            </label>
            <label class="radio">
              <input type="radio" name="template-wizard-mode" value="scratch" />
              <span>Neu von Grund auf</span>
            </label>
            <button id="template-wizard-prev" type="button" class="secondary small">Zur&uuml;ck</button>
            <button id="template-wizard-next" type="button" class="secondary small">N&auml;chster Schritt</button>
            <small id="template-wizard-step-label" class="hint"></small>
          </div>
          <small id="template-wizard-hint" class="hint top-space"></small>
        </div>

        <div class="panel top-space">
          <h3>Filter</h3>
          <div class="grid-3">
            <label>Suche
              <input id="template-filter-search" placeholder="Titel, Beschreibung, Kategorie" />
            </label>
            <label>Tag
              <input id="template-filter-tag" placeholder="z. B. differenzierung" />
            </label>
            <label>Scope
              <select id="template-filter-scope">
                <option value="">Alle</option>
                <option value="official">Official</option>
                <option value="personal">Personal</option>
                <option value="community">Community</option>
              </select>
            </label>
          </div>
          <div class="grid-3 top-space">
            <label>Review-State
              <select id="template-filter-review">
                <option value="">Alle</option>
                <option value="draft">draft</option>
                <option value="submitted">submitted</option>
                <option value="approved">approved</option>
                <option value="rejected">rejected</option>
              </select>
            </label>
            <label>Tag-Katalog
              <select id="template-tag-catalog"></select>
            </label>
            <label>Template-Bewertung (1-5)
              <input id="template-rating-value" type="number" min="1" max="5" placeholder="optional" />
            </label>
          </div>
          <div class="inline-actions top-space">
            <button id="template-refresh" type="button">Aktualisieren</button>
            <button id="template-clear-selection" type="button" class="secondary">Auswahl aufheben</button>
            <small id="template-studio-status" class="hint"></small>
          </div>
        </div>

        <div id="template-list-panel" class="panel top-space">
          <h3>Template Liste</h3>
          <div id="template-list" class="list-cards"></div>
        </div>

        <div id="template-node-tag-panel" class="grid-2 top-space">
          <div class="panel">
            <h3>Taxonomie Node erstellen</h3>
            <label>Parent Node
              <select id="template-node-parent"></select>
            </label>
            <label class="top-space">Typ
              <select id="template-node-type">
                <option value="category">category</option>
                <option value="subcategory">subcategory</option>
                <option value="group">group</option>
              </select>
            </label>
            <label class="top-space">Scope
              <select id="template-node-scope">
                <option value="personal">personal</option>
                <option value="community">community</option>
                <option value="official">official</option>
              </select>
            </label>
            <label class="top-space">Name
              <input id="template-node-name" placeholder="z. B. Mathematik Sek I" />
            </label>
            <label class="top-space">Beschreibung
              <textarea id="template-node-description" rows="2"></textarea>
            </label>
            <div class="inline-actions top-space">
              <button id="template-node-create" type="button">Node erstellen</button>
            </div>
          </div>

          <div class="panel">
            <h3>Tag anlegen</h3>
            <label>Tag Key
              <input id="template-new-tag-key" placeholder="z. B. projektlernen" />
            </label>
            <label class="top-space">Anzeigename
              <input id="template-new-tag-name" placeholder="z. B. Projektlernen" />
            </label>
            <label class="top-space">Beschreibung
              <textarea id="template-new-tag-description" rows="2"></textarea>
            </label>
            <label class="checkbox top-space">
              <input id="template-new-tag-official" type="checkbox" />
              <span>Als official Tag markieren (nur Moderation)</span>
            </label>
            <div class="inline-actions top-space">
              <button id="template-tag-create" type="button">Tag speichern</button>
            </div>
          </div>
        </div>

        <div id="template-editor-panel" class="panel top-space">
          <h3>Template Editor</h3>
          <small id="template-selected-id" class="hint">Ausgew&auml;hlt: -</small>
          <div id="template-editor-grid" class="grid-2 top-space">
            <label data-template-step="1">Title
              <input id="template-form-title" placeholder="Template Titel" />
            </label>
            <label data-template-step="1">Scope
              <select id="template-form-scope">
                <option value="personal">personal</option>
                <option value="community">community</option>
                <option value="official">official</option>
              </select>
            </label>
            <label data-template-step="1">Node
              <select id="template-form-node"></select>
            </label>
            <label data-template-step="1">Profil
              <input id="template-form-profile" placeholder="unterrichtsnah | kommunikation | organisation_admin" />
            </label>
            <label class="span-2" data-template-step="1">Beschreibung
              <textarea id="template-form-description" rows="2"></textarea>
            </label>
            <label class="span-2" data-template-step="2">Required Base Fields (CSV)
              <input id="template-form-required-base" placeholder="fach,schulstufe,ziel" />
            </label>
            <label class="span-2" data-template-step="2">Optional Base Fields (CSV)
              <input id="template-form-optional-base" placeholder="zeitrahmen,niveau,rahmen,ergebnisformat,ton,rueckfragen" />
            </label>
            <label class="span-2" data-template-step="2">Tags (CSV)
              <input id="template-form-tags" placeholder="differenzierung,planung" />
            </label>
            <label data-template-step="2">Prompt Mode
              <select id="template-form-prompt-mode">
                <option value="schema">schema</option>
                <option value="custom">custom</option>
              </select>
            </label>
            <label data-template-step="2">Taxonomy Path (CSV)
              <input id="template-form-taxonomy-path" placeholder="Jahresplanung,Semesterplanung" />
            </label>
            <label class="span-2" data-template-step="2">Dynamic Fields (JSON Array)
              <textarea id="template-form-dynamic-fields" rows="6" placeholder='[{"id":"lernziel","label":"Lernziel","type":"text","required":true}]'></textarea>
            </label>
            <label class="span-2" data-template-step="2">Base Prompt (nur bei custom)
              <textarea id="template-form-base-prompt" rows="6"></textarea>
            </label>
            <label class="span-2" data-template-step="3">Change Note
              <input id="template-form-change-note" placeholder="Kurzbeschreibung der &Auml;nderung" />
            </label>
            <label class="span-2" data-template-step="3">Review Note
              <input id="template-form-review-note" placeholder="Optionaler Kommentar f&uuml;r Review" />
            </label>
          </div>
          <div id="template-editor-actions" class="inline-actions top-space">
            <button id="template-create" type="button">Template erstellen</button>
            <button id="template-update" type="button" class="secondary">Neue Version speichern</button>
            <button id="template-submit" type="button" class="secondary">Zur Review einreichen</button>
            <button id="template-clone" type="button" class="secondary">Als pers&ouml;nliche Variante speichern</button>
            <button id="template-approve" type="button" class="secondary">Approve</button>
            <button id="template-reject" type="button" class="secondary">Reject</button>
            <button id="template-rate" type="button" class="secondary">Bewertung speichern</button>
          </div>
        </div>
      </section>

      <section id="screen-admin" class="screen is-hidden">
        <div class="step-nav">
          <button id="btn-back-home-from-admin" type="button" class="link-btn">&larr; Zur&uuml;ck zur &Uuml;bersicht</button>
        </div>
        <h2>Administration</h2>
        <p class="subline">Rollen, Berechtigungen und Authentik-Gruppenzuordnungen verwalten.</p>
        <small id="admin-status" class="hint"></small>

        <div id="admin-tab-nav" class="chip-row top-space admin-tab-nav">
          <button type="button" class="secondary is-active" data-admin-tab="roles">Rollen &amp; Berechtigungen</button>
          <button type="button" class="secondary" data-admin-tab="groups">Authentik Zuordnung</button>
          <button type="button" class="secondary" data-admin-tab="users">Benutzer</button>
          <button type="button" class="secondary" data-admin-tab="models">Model Administration</button>
          <button type="button" class="secondary" data-admin-tab="keys">API-Key Management</button>
        </div>

        <div id="admin-tab-roles" class="admin-tab-panel top-space">
          <div class="grid-2">
            <div class="panel">
              <h3>Neue Rolle</h3>
              <label>Role Key
                <input id="admin-new-role-key" placeholder="z. B. content_editors" />
              </label>
              <label class="top-space">Role Name
                <input id="admin-new-role-name" placeholder="z. B. Content Editors" />
              </label>
              <label class="top-space">Beschreibung
                <textarea id="admin-new-role-description" rows="2"></textarea>
              </label>
              <div class="inline-actions top-space">
                <button id="admin-create-role" type="button">Rolle anlegen</button>
              </div>
            </div>

            <div class="panel">
              <h3>Rolle bearbeiten</h3>
              <label>Rolle
                <select id="admin-role-select"></select>
              </label>
              <label class="top-space">Role Name
                <input id="admin-role-name" />
              </label>
              <label class="top-space">Beschreibung
                <textarea id="admin-role-description" rows="2"></textarea>
              </label>
              <small id="admin-role-system" class="hint"></small>
              <div class="inline-actions top-space">
                <button id="admin-save-role" type="button">Rolle speichern</button>
                <button id="admin-delete-role" type="button" class="secondary">Rolle l&ouml;schen</button>
              </div>
            </div>
          </div>

          <div class="panel top-space">
            <h3>Neue Berechtigung</h3>
            <div class="grid-2">
              <label>Permission Key
                <input id="admin-new-permission-key" placeholder="z. B. templates.publish" />
              </label>
              <label>Beschreibung
                <input id="admin-new-permission-description" placeholder="Kurze Beschreibung" />
              </label>
            </div>
            <div class="inline-actions top-space">
              <button id="admin-create-permission" type="button">Berechtigung anlegen</button>
            </div>
          </div>

          <div class="panel top-space">
            <div class="panel-title-row">
              <h3>Berechtigungen der Rolle</h3>
              <small class="hint">Nach Dom&auml;nen gruppiert</small>
            </div>
            <div id="admin-role-permissions" class="admin-permissions-grid top-space"></div>
            <div class="inline-actions top-space">
              <button id="admin-save-permissions" type="button">Berechtigungen speichern</button>
            </div>
          </div>
        </div>

        <div id="admin-tab-groups" class="admin-tab-panel top-space is-hidden">
          <div class="panel">
            <h3>Authentik Gruppen - Rollen</h3>
            <div class="grid-2">
              <label>Authentik Gruppe
                <input id="admin-binding-group" placeholder="z. B. prompt_creator_template_reviewers" />
              </label>
              <label>Rolle
                <select id="admin-binding-role"></select>
              </label>
            </div>
            <div class="inline-actions top-space">
              <button id="admin-add-binding" type="button">Zuordnung speichern</button>
            </div>
            <ul id="admin-binding-list" class="provider-list top-space"></ul>
          </div>
        </div>

        <div id="admin-tab-users" class="admin-tab-panel top-space is-hidden">
          <div class="panel">
            <div class="panel-title-row">
              <h3>Benutzerverwaltung (Phase 1)</h3>
              <small class="hint">Settings zurücksetzen, Intro erneut auslösen, persönliche API-Keys widerrufen.</small>
            </div>
            <div class="grid-2 top-space">
              <label>Suche
                <input id="admin-user-search" placeholder="User, Gruppe, Rolle..." />
              </label>
              <label>Aktion
                <button id="admin-user-refresh" type="button" class="secondary">Liste aktualisieren</button>
              </label>
            </div>
            <small id="admin-user-status" class="hint top-space"></small>
            <div id="admin-user-list" class="top-space"></div>
          </div>
        </div>

        <div id="admin-tab-models" class="admin-tab-panel top-space is-hidden">
          <div id="admin-pricing-panel" class="panel">
            <div class="panel-title-row">
              <h3>Model Administration</h3>
              <small class="hint">Master-Record f&uuml;r Provider-Modellauswahl</small>
            </div>
            <div id="admin-model-provider-tabs" class="chip-row admin-provider-tabs"></div>
            <div class="grid-3 top-space">
              <label>Provider
                <select id="admin-pricing-provider-kind">
                  <option value="openai">openai</option>
                  <option value="anthropic">anthropic</option>
                  <option value="google">google</option>
                  <option value="mistral">mistral</option>
                  <option value="custom">custom</option>
                </select>
              </label>
              <label>Modell
                <input id="admin-pricing-model" placeholder="z. B. gpt-5-mini" />
              </label>
              <label>Waehrung
                <input id="admin-pricing-currency" value="USD" />
              </label>
              <label>Input USD / 1M
                <input id="admin-pricing-input" type="number" min="0" step="0.000001" placeholder="optional" />
              </label>
              <label>Output USD / 1M
                <input id="admin-pricing-output" type="number" min="0" step="0.000001" placeholder="optional" />
              </label>
              <label>Aktiv
                <select id="admin-pricing-active">
                  <option value="true" selected>Ja</option>
                  <option value="false">Nein</option>
                </select>
              </label>
            </div>
            <div class="inline-actions top-space">
              <button id="admin-pricing-save" type="button">Eintrag speichern</button>
              <button id="admin-pricing-clear" type="button" class="secondary">Form leeren</button>
              <small id="admin-pricing-status" class="hint"></small>
            </div>
            <div id="admin-model-provider-groups" class="top-space"></div>
          </div>
        </div>

        <div id="admin-tab-keys" class="admin-tab-panel top-space is-hidden">
          <div id="admin-system-keys-panel" class="panel top-space">
            <div class="panel-title-row">
              <h3>Systemweite API-Keys</h3>
              <small class="hint">Aktive Schlüssel können Usern, Rollen oder Gruppen zugewiesen werden.</small>
            </div>
            <div id="admin-system-key-list" class="top-space"></div>
            <button id="admin-system-key-create-toggle" type="button" class="admin-create-dashed top-space">
              <span class="material-icons-round">add_circle</span>
              <span class="admin-create-label">Add New API Key</span>
            </button>
            <div id="admin-system-key-create-form" class="grid-3 top-space is-hidden">
              <label>System Key ID
                <input id="admin-system-key-id" placeholder="optional, z. B. pc_google_main" />
              </label>
              <label>Name
                <input id="admin-system-key-name" placeholder="z. B. Schulkontingent Google" />
              </label>
              <label>Provider
                <select id="admin-system-key-provider-kind">
                  <option value="openai">openai</option>
                  <option value="anthropic">anthropic</option>
                  <option value="google">google</option>
                  <option value="mistral">mistral</option>
                  <option value="custom">custom</option>
                </select>
              </label>
              <label>Modell-Hinweis (optional)
                <select id="admin-system-key-model-select"></select>
              </label>
              <label id="admin-system-key-model-custom-wrap" class="is-hidden">Custom Modell
                <input id="admin-system-key-model-custom" placeholder="z. B. gemini-3-flash-preview" />
              </label>
              <label>Base URL (optional)
                <input id="admin-system-key-base-url" placeholder="https://api.example.com/v1" />
              </label>
              <label>API-Key
                <input id="admin-system-key-api-key" type="password" placeholder="leer lassen = bestehenden Key behalten (bei Update)" />
              </label>
              <label>Aktiv
                <select id="admin-system-key-active">
                  <option value="true" selected>Ja</option>
                  <option value="false">Nein</option>
                </select>
              </label>
            </div>
            <div id="admin-system-key-create-actions" class="inline-actions top-space is-hidden">
              <button id="admin-system-key-save" type="button" class="admin-primary-action">System-Key speichern</button>
              <button id="admin-system-key-clear" type="button" class="secondary">Form leeren</button>
            </div>
            <small id="admin-system-key-status" class="hint top-space"></small>
          </div>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      <div class="app-footer-inner">
        <span>&copy; 2026 EduPrompt-AT. Alle Rechte vorbehalten.</span>
        <div class="app-footer-links">
          <button type="button" class="text-btn">Datenschutz</button>
          <button type="button" class="text-btn">Impressum</button>
          <button type="button" class="text-btn">Support</button>
        </div>
      </div>
    </footer>

    <aside id="provider-drawer" class="drawer is-hidden">
      <div class="drawer-head">
        <h2>API-Provider</h2>
        <button id="close-provider-drawer" type="button" class="text-btn">Schliessen</button>
      </div>
      <div class="drawer-body">
        <div class="panel">
          <p class="subline">API-Keys werden serverseitig verschl&uuml;sselt gespeichert und nie im Klartext angezeigt.</p>
          <div class="inline-actions top-space">
            <button id="unlock-vault" type="button">Hinweis anzeigen</button>
            <button id="lock-vault" type="button" class="secondary">Status aktualisieren</button>
          </div>
          <small id="vault-status" class="hint"></small>
        </div>

        <div class="provider-editor-controls top-space">
          <label>Editor-Modus
            <select id="provider-editor-mode">
              <option value="modal" selected>Modal</option>
              <option value="inline">Inline</option>
            </select>
          </label>
        </div>

        <div id="provider-form-inline-host" class="top-space is-hidden"></div>

        <div id="provider-form-modal" class="modal is-hidden">
          <div class="modal-card provider-editor-modal-card">
            <div class="panel-title-row">
              <h3 id="provider-editor-title">API-Key hinzufügen</h3>
              <button id="provider-editor-close" type="button" class="text-btn">Schliessen</button>
            </div>
            <div id="provider-form-modal-host"></div>
          </div>
        </div>

        <div id="provider-form-default-host" class="is-hidden"></div>

        <form id="provider-form" class="panel top-space provider-editor-form is-hidden">
          <div class="grid-2">
            <label>Anzeigename
              <input id="provider-name" required placeholder="z. B. OpenAI Schule" />
            </label>
            <label>Provider
              <select id="provider-kind" required>
                <option value="openai">OpenAI</option>
                <option value="anthropic">Anthropic</option>
                <option value="mistral">Mistral</option>
                <option value="google">Google</option>
                <option value="custom">Custom API</option>
              </select>
            </label>
            <label>Modell
              <select id="provider-model" required></select>
            </label>
            <label>API-Key
              <input id="provider-key" type="password" placeholder="leer lassen = vorhandenen Key behalten" />
            </label>
            <label>Key-Quelle
              <select id="provider-key-source">
                <option value="provider" selected>Eigener API-Key</option>
                <option value="system">Zugewiesener System-Key</option>
              </select>
            </label>
            <label id="provider-system-key-wrap" class="is-hidden">System-Key
              <select id="provider-system-key-id"></select>
            </label>
            <label id="provider-model-custom-wrap" class="span-2 is-hidden">Custom Modell
              <input id="provider-model-custom" placeholder="z. B. mein-spezialmodell-v1" />
            </label>
            <small id="provider-model-hint" class="hint span-2"></small>
            <label>Pricing-Modus
              <select id="provider-pricing-mode">
                <option value="catalog" selected>Katalog (Admin-Preise)</option>
                <option value="custom">Custom (eigene Preise)</option>
              </select>
            </label>
            <label id="provider-pricing-input-wrap" class="is-hidden">Input USD / 1M
              <input id="provider-pricing-input" type="number" min="0" step="0.000001" placeholder="z. B. 0.300000" />
            </label>
            <label id="provider-pricing-output-wrap" class="is-hidden">Output USD / 1M
              <input id="provider-pricing-output" type="number" min="0" step="0.000001" placeholder="z. B. 1.200000" />
            </label>
            <small id="provider-pricing-hint" class="hint span-2">Kostenberechnung nutzt den Admin-Katalog oder deine Custom-Werte.</small>
            <label class="span-2">API Base URL (optional)
              <input id="provider-base" placeholder="https://api.example.com/v1" />
            </label>
            <label class="checkbox span-2">
              <input id="provider-auto-base" type="checkbox" checked />
              <span>Empfohlene Base URL verwenden (gesperrt, bis deaktiviert)</span>
            </label>
            <small id="provider-base-hint" class="hint span-2"></small>
          </div>
          <div class="inline-actions top-space">
            <button type="submit">Provider speichern</button>
            <button id="provider-test" type="button" class="secondary">Provider testen</button>
            <button id="provider-reset" type="button" class="secondary">Formular leeren</button>
          </div>
        </form>

        <div class="panel top-space">
          <h4>Aktive Key-Auswahl je Stage</h4>
          <div id="provider-stage-summary" class="provider-stage-summary top-space">
            <div id="provider-stage-chip-metaprompt" class="provider-stage-summary-chip">
              <small>Metaprompt</small>
              <strong>-</strong>
            </div>
            <div id="provider-stage-chip-result" class="provider-stage-summary-chip">
              <small>Result</small>
              <strong>-</strong>
            </div>
          </div>
          <div class="inline-actions top-space">
            <button id="provider-check-stages" type="button" class="secondary small">API-Key Status pr&uuml;fen</button>
          </div>
          <small id="provider-active-stage-status" class="hint"></small>
          <small id="provider-stage-health" class="hint"></small>
          <label class="is-hidden"><span id="provider-active-label">Aktiver Provider</span>
            <select id="active-provider"></select>
          </label>
          <ul id="provider-list" class="provider-list top-space"></ul>
        </div>
      </div>
    </aside>

    <aside id="options-drawer" class="drawer is-hidden">
      <div class="drawer-head">
        <h2>Optionen</h2>
        <button id="close-options-drawer" type="button" class="text-btn">Schliessen</button>
      </div>
      <div class="drawer-body">
        <div class="panel">
          <h3>Theme</h3>
          <label class="radio"><input type="radio" name="theme" value="system" /> System</label>
          <label class="radio"><input type="radio" name="theme" value="light" /> Light</label>
          <label class="radio"><input type="radio" name="theme" value="dark" /> Dark</label>
        </div>

        <div class="panel top-space">
          <h3>Flow-Modus</h3>
          <label class="radio"><input type="radio" name="flow-mode" value="step" /> Schrittweise Ansicht</label>
          <label class="radio"><input type="radio" name="flow-mode" value="single" /> Kompaktansicht</label>
        </div>

        <div class="panel top-space">
          <h3>Generierungsmodus</h3>
          <label class="radio"><input type="radio" name="generation-mode" value="prompt" /> Prompt-only (Standard)</label>
          <label class="radio"><input type="radio" name="generation-mode" value="result" /> Direktes Ergebnis (Beta)</label>
          <small class="hint">Der Result-Modus ist optional und bleibt standardmaessig deaktiviert.</small>
        </div>

        <div class="panel top-space">
          <h3>Navigation</h3>
          <label class="radio"><input type="radio" name="nav-layout" value="topbar" /> Topbar (klassisch)</label>
          <label class="radio"><input type="radio" name="nav-layout" value="sidebar" /> Sidebar (Desktop)</label>
          <small class="hint">Auf Mobilger&auml;ten bleibt die kompakte Topbar aktiv.</small>
        </div>

        <div class="panel top-space">
          <h3>Library-Detailansicht</h3>
          <label class="radio"><input type="radio" name="library-detail-view" value="page" /> Seitenansicht</label>
          <label class="radio"><input type="radio" name="library-detail-view" value="modal" /> Modal</label>
          <small class="hint">Legt fest, wie ein Library-Eintrag bei Kartenklick ge&ouml;ffnet wird.</small>
        </div>

        <div class="panel top-space">
          <h3>Standardverhalten</h3>
          <label class="checkbox"><input id="setting-copy-metadata" type="checkbox" /><span>Metadata beim Kopieren standardmaessig aktivieren</span></label>
          <label class="checkbox"><input id="setting-advanced-open" type="checkbox" /><span>Erweiterte Optionen standardmaessig offen</span></label>
          <label class="checkbox"><input id="setting-show-community" type="checkbox" /><span>Community-Templates in Katalog anzeigen</span></label>
        </div>

        <div class="inline-actions top-space">
          <button id="save-settings" type="button">Einstellungen speichern</button>
          <small id="settings-status" class="hint"></small>
        </div>
      </div>
    </aside>

    <div id="flow-choice-modal" class="modal is-hidden">
      <div class="modal-card">
        <h2>Ansicht w&auml;hlen</h2>
        <p class="subline">Du kannst das spaeter jederzeit unter Optionen aendern.</p>
        <div class="inline-actions top-space">
          <button id="choose-flow-step" type="button">Schrittweise Ansicht</button>
          <button id="choose-flow-single" type="button" class="secondary">Kompaktansicht</button>
        </div>
      </div>
    </div>

    <div id="intro-tour-modal" class="modal is-hidden">
      <div class="modal-card intro-tour-card">
        <small id="intro-tour-progress" class="hint"></small>
        <h2 id="intro-tour-title">Willkommen</h2>
        <p id="intro-tour-text" class="subline"></p>
        <small id="intro-tour-anchor" class="hint"></small>
        <div class="inline-actions top-space">
          <button id="intro-tour-prev" type="button" class="secondary">Zur&uuml;ck</button>
          <button id="intro-tour-next" type="button">Weiter</button>
          <button id="intro-tour-open" type="button" class="secondary is-hidden">Bereich &ouml;ffnen</button>
          <button id="intro-tour-finish" type="button" class="secondary is-hidden">Tour abschliessen</button>
          <button id="intro-tour-skip" type="button" class="text-btn">&Uuml;berspringen</button>
        </div>
      </div>
    </div>

    <div id="setup-wizard-modal" class="modal is-hidden">
      <div class="modal-card">
        <h2>Schnellstart</h2>
        <p class="subline">In 3 Schritten bist du startklar:</p>
        <ol class="wizard-list top-space">
          <li>Provider einrichten (API-Provider).</li>
          <li>Verbindung testen (inkl. Modell + API-Key).</li>
          <li>Ersten Prompt generieren.</li>
        </ol>
        <div class="inline-actions top-space">
          <button id="wizard-open-provider" type="button">Provider einrichten</button>
          <button id="wizard-test-provider" type="button" class="secondary">Aktiven Provider testen</button>
          <button id="wizard-complete" type="button" class="secondary">Setup abgeschlossen</button>
          <button id="wizard-skip" type="button" class="text-btn">Sp&auml;ter</button>
        </div>
        <small id="wizard-status" class="hint top-space"></small>
      </div>
    </div>

    <div id="library-entry-modal" class="modal is-hidden">
      <div class="modal-card library-entry-modal-card">
        <div class="inline-actions align-end">
          <button id="library-entry-modal-close" type="button" class="secondary small">Schlie&szlig;en</button>
        </div>
        <div id="library-entry-modal-content" class="top-space"></div>
      </div>
    </div>

    <div id="app-toast-stack" class="app-toast-stack" aria-live="polite" aria-atomic="true"></div>
    <div id="overlay" class="overlay is-hidden"></div>

    <script type="module" src="app.js"></script>
  </body>
</html>
